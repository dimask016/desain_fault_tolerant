<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skenario Failover & Failback Otomatis</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .timer-panel {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            display: none;
        }
        
        .timer-panel.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .timer-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .timer-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: rgba(255, 255, 255, 0.15);
            padding: 10px 20px;
            border-radius: 6px;
            min-width: 150px;
        }
        
        .timer-label {
            font-size: 0.9rem;
            margin-bottom: 5px;
            opacity: 0.9;
        }
        
        .timer-value {
            font-size: 1.8rem;
            font-weight: bold;
            font-family: monospace;
        }
        
        .timer-value.countdown {
            color: #ffcc80;
        }
        
        .timer-value.executing {
            color: #a5d6a7;
        }
        
        .timer-value.completed {
            color: #4caf50;
        }
        
        .scenario-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        @media (max-width: 1100px) {
            .scenario-container {
                grid-template-columns: 1fr;
            }
        }
        
        .environment {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            position: relative;
        }
        
        .environment:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .environment-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
            display: flex;
            align-items: center;
        }
        
        .environment-title i {
            margin-right: 10px;
            font-size: 1.5rem;
        }
        
        .local-env .environment-title {
            color: #1976d2;
        }
        
        .cloud-env .environment-title {
            color: #388e3c;
        }
        
        .environment-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .badge-primary {
            background-color: #e3f2fd;
            color: #1976d2;
        }
        
        .badge-secondary {
            background-color: #e8f5e9;
            color: #388e3c;
        }
        
        .badge-failed {
            background-color: #ffebee;
            color: #f44336;
        }
        
        .badge-recovering {
            background-color: #f3e5f5;
            color: #9c27b0;
        }
        
        .badge-high-availability {
            background-color: #fff3e0;
            color: #f57c00;
        }
        
        .components {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
        }
        
        .component {
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 20px 15px;
            text-align: center;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .component.active {
            background-color: #e8f5e9;
            border-color: #4caf50;
        }
        
        .component.inactive {
            background-color: #f5f5f5;
            border-color: #bdbdbd;
            opacity: 0.7;
        }
        
        .component.failed {
            background-color: #ffebee;
            border-color: #f44336;
        }
        
        .component.recovering {
            background-color: #fff8e1;
            border-color: #ffc107;
            animation: pulse-recovery 1.5s infinite;
        }
        
        .component.standby {
            background-color: #e3f2fd;
            border-color: #2196f3;
        }
        
        .component.active-standby {
            background-color: #e8f5e9;
            border-color: #4caf50;
            border-style: dashed;
        }
        
        .component.high-availability {
            background-color: #e8f5e9;
            border-color: #4caf50;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.3);
        }
        
        .component i {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .component h3 {
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .component p {
            font-size: 0.9rem;
            color: #666;
        }
        
        .ha-badge {
            display: inline-block;
            background-color: #fff3e0;
            color: #f57c00;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            margin-left: 5px;
            font-weight: bold;
        }
        
        .traffic-flow {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px dashed #ddd;
        }
        
        .flow-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .flow-title i {
            margin-right: 10px;
            color: #ff9800;
        }
        
        .flow-container {
            position: relative;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .flow-arrow {
            position: absolute;
            font-size: 2.5rem;
            color: #ff9800;
            animation: pulse 2s infinite;
        }
        
        .flow-text {
            position: absolute;
            background-color: #ff9800;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            box-shadow: 0 3px 10px rgba(255, 152, 0, 0.3);
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 40px 0;
            flex-wrap: wrap;
        }
        
        button {
            padding: 15px 30px;
            font-size: 1.1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        button i {
            margin-right: 10px;
        }
        
        .btn-failover {
            background-color: #f44336;
            color: white;
        }
        
        .btn-failover:hover:not(:disabled) {
            background-color: #d32f2f;
            transform: scale(1.05);
        }
        
        .btn-failover:disabled {
            background-color: #ffcdd2;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-failback {
            background-color: #ff9800;
            color: white;
        }
        
        .btn-failback:hover:not(:disabled) {
            background-color: #f57c00;
            transform: scale(1.05);
        }
        
        .btn-failback:disabled {
            background-color: #ffecb3;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-reset {
            background-color: #757575;
            color: white;
        }
        
        .btn-reset:hover {
            background-color: #616161;
            transform: scale(1.05);
        }
        
        .btn-simulate {
            background-color: #2196f3;
            color: white;
        }
        
        .btn-simulate:hover:not(:disabled) {
            background-color: #1976d2;
            transform: scale(1.05);
        }
        
        .btn-simulate:disabled {
            background-color: #bbdefb;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-recover {
            background-color: #9c27b0;
            color: white;
        }
        
        .btn-recover:hover:not(:disabled) {
            background-color: #7b1fa2;
            transform: scale(1.05);
        }
        
        .btn-recover:disabled {
            background-color: #e1bee7;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-manual {
            background-color: #607d8b;
            color: white;
        }
        
        .btn-manual:hover:not(:disabled) {
            background-color: #455a64;
            transform: scale(1.05);
        }
        
        .btn-manual:disabled {
            background-color: #cfd8dc;
            cursor: not-allowed;
            transform: none;
        }
        
        .status-panel {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            margin-top: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .status-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #1a237e;
            display: flex;
            align-items: center;
        }
        
        .status-title i {
            margin-right: 10px;
        }
        
        .status-content {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .status-item {
            padding: 15px;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        
        .status-item h4 {
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: #333;
        }
        
        .status-item p {
            font-size: 1rem;
            color: #666;
        }
        
        .status-item .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-indicator.active {
            background-color: #4caf50;
        }
        
        .status-indicator.inactive {
            background-color: #f44336;
        }
        
        .status-indicator.standby {
            background-color: #ff9800;
        }
        
        .status-indicator.recovering {
            background-color: #9c27b0;
            animation: pulse 1.5s infinite;
        }
        
        .status-indicator.high-availability {
            background-color: #4caf50;
            box-shadow: 0 0 5px #4caf50;
        }
        
        .status-indicator.active-standby {
            background-color: #4caf50;
            border: 2px solid #2196f3;
        }
        
        .log {
            margin-top: 30px;
            padding: 20px;
            background-color: #1a237e;
            color: white;
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .log-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #bbdefb;
        }
        
        .log-entry {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-family: monospace;
            font-size: 0.9rem;
        }
        
        .log-time {
            color: #bbdefb;
            margin-right: 10px;
        }
        
        .log-event {
            color: white;
        }
        
        .log-event.failover {
            color: #ffcc80;
        }
        
        .log-event.failback {
            color: #ce93d8;
        }
        
        .log-event.error {
            color: #ff8a80;
        }
        
        .log-event.recovery {
            color: #80ffa0;
        }
        
        .log-event.warning {
            color: #ffd54f;
        }
        
        .log-event.automatic {
            color: #80deea;
        }
        
        .log-event.database {
            color: #a5d6a7;
        }
        
        .log-event.ha {
            color: #ffcc80;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            color: #666;
            font-size: 0.9rem;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulse {
            0% { opacity: 0.7; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.1); }
            100% { opacity: 0.7; transform: scale(1); }
        }
        
        @keyframes pulse-recovery {
            0% { border-color: #ffc107; }
            50% { border-color: #ffecb3; }
            100% { border-color: #ffc107; }
        }
        
        @keyframes highlight {
            0% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(76, 175, 80, 0); }
            100% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0); }
        }
        
        .highlight {
            animation: highlight 1.5s ease;
        }
        
        .auto-mode-badge {
            display: inline-block;
            background-color: #e1f5fe;
            color: #0277bd;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-left: 10px;
            font-weight: normal;
        }
        
        .workflow {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .workflow-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0 15px;
            position: relative;
        }
        
        .workflow-step i {
            font-size: 2rem;
            background-color: #e3f2fd;
            color: #1976d2;
            width: 70px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            margin-bottom: 10px;
        }
        
        .workflow-step span {
            font-weight: bold;
            color: #333;
        }
        
        .workflow-arrow {
            font-size: 1.5rem;
            color: #757575;
            margin: 0 10px;
        }
        
        @media (max-width: 768px) {
            .workflow-arrow {
                transform: rotate(90deg);
                margin: 10px 0;
            }
            
            .workflow {
                flex-direction: column;
            }
        }
        
        .db-badge {
            display: inline-block;
            background-color: #e8f5e9;
            color: #388e3c;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            margin-left: 5px;
            font-weight: bold;
        }
        
        .db-badge.standby {
            background-color: #e3f2fd;
            color: #1976d2;
        }
        
        .db-badge.primary {
            background-color: #fff3e0;
            color: #ef6c00;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-robot"></i> Skenario Failover & Failback Otomatis</h1>
            <p class="subtitle">Ilustrasi interaktif dengan failover dan failback otomatis setelah 5 detik. Environment Cloud dalam mode High Availability aktif.</p>
            
            <div class="timer-panel" id="timerPanel">
                <div class="timer-info">
                    <div class="timer-item" id="failoverTimerContainer">
                        <div class="timer-label">Failover Otomatis Dalam:</div>
                        <div class="timer-value countdown" id="failoverTimer">5s</div>
                    </div>
                    <div class="timer-item" id="failbackTimerContainer">
                        <div class="timer-label">Failback Otomatis Dalam:</div>
                        <div class="timer-value countdown" id="failbackTimer">5s</div>
                    </div>
                </div>
            </div>
        </header>
        
        <div class="workflow">
            <div class="workflow-step">
                <i class="fas fa-server"></i>
                <span>Lokal Aktif</span>
            </div>
            <div class="workflow-arrow"><i class="fas fa-arrow-right"></i></div>
            <div class="workflow-step">
                <i class="fas fa-exclamation-triangle"></i>
                <span>Gangguan Lokal<span class="auto-mode-badge">Auto Failover</span></span>
            </div>
            <div class="workflow-arrow"><i class="fas fa-arrow-right"></i></div>
            <div class="workflow-step">
                <i class="fas fa-cloud"></i>
                <span>Failover ke Cloud <span class="ha-badge">HA</span></span>
            </div>
            <div class="workflow-arrow"><i class="fas fa-arrow-right"></i></div>
            <div class="workflow-step">
                <i class="fas fa-tools"></i>
                <span>Perbaikan Lokal<span class="auto-mode-badge">Auto Failback</span></span>
            </div>
            <div class="workflow-arrow"><i class="fas fa-arrow-right"></i></div>
            <div class="workflow-step">
                <i class="fas fa-exchange-alt"></i>
                <span>Failback ke Lokal</span>
            </div>
        </div>
        
        <div class="scenario-container">
            <div class="environment local-env">
                <div class="environment-badge badge-primary" id="local-badge">Primary</div>
                <h2 class="environment-title"><i class="fas fa-server"></i> Environment Lokal (On-Premise)</h2>
                <div class="components">
                    <div class="component active" id="local-loadbalancer">
                        <i class="fas fa-balance-scale"></i>
                        <h3>Load Balancer</h3>
                        <p>Status: <span class="status-text">Aktif</span></p>
                    </div>
                    
                    <div class="component active" id="local-app1">
                        <i class="fas fa-laptop-code"></i>
                        <h3>Aplikasi 1</h3>
                        <p>Status: <span class="status-text">Aktif</span></p>
                    </div>
                    
                    <div class="component active" id="local-app2">
                        <i class="fas fa-laptop-code"></i>
                        <h3>Aplikasi 2</h3>
                        <p>Status: <span class="status-text">Aktif</span></p>
                    </div>
                    
                    <div class="component active-standby" id="local-db">
                        <i class="fas fa-database"></i>
                        <h3>Database <span class="db-badge primary">Primary</span></h3>
                        <p>Status: <span class="status-text">Aktif-Primary</span></p>
                    </div>
                </div>
                
                <div class="traffic-flow">
                    <h3 class="flow-title"><i class="fas fa-traffic-light"></i> Aliran Traffic</h3>
                    <div class="flow-container" id="local-flow">
                        <div class="flow-arrow"><i class="fas fa-long-arrow-alt-right"></i></div>
                        <div class="flow-text">100% Traffic</div>
                    </div>
                </div>
            </div>
            
            <div class="environment cloud-env">
                <div class="environment-badge badge-high-availability" id="cloud-badge">High Availability</div>
                <h2 class="environment-title"><i class="fas fa-cloud"></i> Environment Cloud (HA Backup)</h2>
                <div class="components">
                    <div class="component high-availability" id="cloud-loadbalancer">
                        <i class="fas fa-balance-scale"></i>
                        <h3>Load Balancer Cloud <span class="ha-badge">HA</span></h3>
                        <p>Status: <span class="status-text">Aktif (HA)</span></p>
                    </div>
                    
                    <div class="component high-availability" id="cloud-app1">
                        <i class="fas fa-laptop-code"></i>
                        <h3>Aplikasi Cloud 1 <span class="ha-badge">HA</span></h3>
                        <p>Status: <span class="status-text">Aktif (HA)</span></p>
                    </div>
                    
                    <div class="component high-availability" id="cloud-app2">
                        <i class="fas fa-laptop-code"></i>
                        <h3>Aplikasi Cloud 2 <span class="ha-badge">HA</span></h3>
                        <p>Status: <span class="status-text">Aktif (HA)</span></p>
                    </div>
                    
                    <div class="component active-standby" id="cloud-db">
                        <i class="fas fa-database"></i>
                        <h3>Database Cloud <span class="db-badge standby">Standby</span></h3>
                        <p>Status: <span class="status-text">Aktif-Standby</span></p>
                    </div>
                </div>
                
                <div class="traffic-flow">
                    <h3 class="flow-title"><i class="fas fa-traffic-light"></i> Aliran Traffic</h3>
                    <div class="flow-container" id="cloud-flow">
                        <div class="flow-arrow" style="opacity: 0.3;"><i class="fas fa-long-arrow-alt-right"></i></div>
                        <div class="flow-text" style="opacity: 0.5; background-color: #bdbdbd;">0% Traffic</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="controls">
            <button class="btn-simulate" id="simulate-failure">
                <i class="fas fa-bolt"></i> Simulasi Gangguan Lokal
            </button>
            
            <button class="btn-failover" id="trigger-failover" disabled>
                <i class="fas fa-exchange-alt"></i> Trigger Failover Manual
            </button>
            
            <button class="btn-recover" id="recover-local" disabled>
                <i class="fas fa-tools"></i> Perbaikan Lokal
            </button>
            
            <button class="btn-failback" id="trigger-failback" disabled>
                <i class="fas fa-exchange-alt"></i> Trigger Failback Manual
            </button>
            
            <button class="btn-manual" id="toggle-auto-mode">
                <i class="fas fa-robot"></i> Mode Otomatis: ON
            </button>
            
            <button class="btn-reset" id="reset-scenario">
                <i class="fas fa-redo"></i> Reset Skenario
            </button>
        </div>
        
        <div class="status-panel">
            <h2 class="status-title"><i class="fas fa-info-circle"></i> Status Sistem</h2>
            <div class="status-content">
                <div class="status-item">
                    <h4><span class="status-indicator active" id="local-status-indicator"></span> Environment Lokal</h4>
                    <p id="local-status-desc">Semua komponen berjalan normal. Menerima 100% traffic. Database dalam mode Primary.</p>
                </div>
                
                <div class="status-item">
                    <h4><span class="status-indicator high-availability" id="cloud-status-indicator"></span> Environment Cloud (HA)</h4>
                    <p id="cloud-status-desc">High Availability aktif. Load balancer & aplikasi dalam mode aktif. Database dalam mode Aktif-Standby.</p>
                </div>
                
                <div class="status-item">
                    <h4><span class="status-indicator active"></span> Monitor Failover</h4>
                    <p id="monitor-status">Aktif dan memantau kesehatan environment lokal setiap 10 detik.</p>
                </div>
                
                <div class="status-item">
                    <h4><span class="status-indicator active"></span> Mode Operasi</h4>
                    <p id="operation-mode">Otomatis - Failover & Failback akan dijalankan otomatis setelah 5 detik.</p>
                </div>
            </div>
            
            <div class="log">
                <h3 class="log-title"><i class="fas fa-clipboard-list"></i> Log Aktivitas</h3>
                <div id="log-entries">
                    <div class="log-entry">
                        <span class="log-time">[12:00:00]</span>
                        <span class="log-event">Sistem dimulai. Environment lokal aktif sebagai primary.</span>
                    </div>
                    <div class="log-entry">
                        <span class="log-time">[12:00:05]</span>
                        <span class="log-event ha">Environment cloud dalam mode High Availability aktif.</span>
                    </div>
                    <div class="log-entry">
                        <span class="log-time">[12:00:10]</span>
                        <span class="log-event database">Replikasi data ke cloud database aktif-standby telah dimulai.</span>
                    </div>
                    <div class="log-entry">
                        <span class="log-time">[12:00:15]</span>
                        <span class="log-event automatic">Mode otomatis aktif. Failover & failback akan dijalankan otomatis setelah 5 detik.</span>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Ilustrasi Skenario Failover dan Failback Otomatis | Environment Cloud dalam mode High Availability aktif</p>
            <p>Mode otomatis dapat dinonaktifkan untuk kontrol manual</p>
        </footer>
    </div>

    <script>
        // Inisialisasi status
        let localStatus = 'active';
        let cloudStatus = 'high-availability';
        let failoverTriggered = false;
        let failbackTriggered = false;
        let localRecovered = false;
        let autoMode = true;
        let failoverTimer = null;
        let failbackTimer = null;
        let failoverCountdown = 5;
        let failbackCountdown = 5;
        let databaseRole = 'local-primary'; // 'local-primary' atau 'cloud-primary'
        
        // Elemen DOM
        const localComponents = document.querySelectorAll('.local-env .component');
        const cloudComponents = document.querySelectorAll('.cloud-env .component');
        const localFlow = document.getElementById('local-flow');
        const cloudFlow = document.getElementById('cloud-flow');
        const localFlowText = localFlow.querySelector('.flow-text');
        const cloudFlowText = cloudFlow.querySelector('.flow-text');
        const localFlowArrow = localFlow.querySelector('.flow-arrow');
        const cloudFlowArrow = cloudFlow.querySelector('.flow-arrow');
        const logEntries = document.getElementById('log-entries');
        const localBadge = document.getElementById('local-badge');
        const cloudBadge = document.getElementById('cloud-badge');
        const timerPanel = document.getElementById('timerPanel');
        const failoverTimerEl = document.getElementById('failoverTimer');
        const failbackTimerEl = document.getElementById('failbackTimer');
        const failoverTimerContainer = document.getElementById('failoverTimerContainer');
        const failbackTimerContainer = document.getElementById('failbackTimerContainer');
        
        // Tombol kontrol
        const btnSimulateFailure = document.getElementById('simulate-failure');
        const btnTriggerFailover = document.getElementById('trigger-failover');
        const btnRecoverLocal = document.getElementById('recover-local');
        const btnTriggerFailback = document.getElementById('trigger-failback');
        const btnToggleAutoMode = document.getElementById('toggle-auto-mode');
        const btnReset = document.getElementById('reset-scenario');
        
        // Status deskripsi
        const localStatusDesc = document.getElementById('local-status-desc');
        const cloudStatusDesc = document.getElementById('cloud-status-desc');
        const monitorStatus = document.getElementById('monitor-status');
        const operationMode = document.getElementById('operation-mode');
        
        // Database elements
        const localDB = document.getElementById('local-db');
        const cloudDB = document.getElementById('cloud-db');
        const localDBBadge = localDB.querySelector('.db-badge');
        const cloudDBBadge = cloudDB.querySelector('.db-badge');
        
        // Fungsi untuk menambahkan log
        function addLog(message, type = 'info') {
            const now = new Date();
            const timeString = `[${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}]`;
            
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `<span class="log-time">${timeString}</span> <span class="log-event ${type}">${message}</span>`;
            
            logEntries.appendChild(logEntry);
            logEntries.scrollTop = logEntries.scrollHeight;
        }
        
        // Fungsi untuk mengupdate status
        function updateStatus() {
            // Update indikator status
            document.getElementById('local-status-indicator').className = `status-indicator ${localStatus}`;
            document.getElementById('cloud-status-indicator').className = `status-indicator ${cloudStatus}`;
            
            // Update deskripsi status
            if (localStatus === 'active') {
                localStatusDesc.textContent = databaseRole === 'local-primary' 
                    ? 'Semua komponen berjalan normal. Menerima 100% traffic. Database dalam mode Primary.' 
                    : 'Komponen aplikasi aktif. Database dalam mode Standby.';
            } else if (localStatus === 'inactive') {
                localStatusDesc.textContent = 'Environment lokal mengalami gangguan. Tidak menerima traffic.';
            } else if (localStatus === 'recovering') {
                localStatusDesc.textContent = 'Environment lokal sedang dalam proses perbaikan.';
            }
            
            if (cloudStatus === 'high-availability') {
                cloudStatusDesc.textContent = databaseRole === 'cloud-primary' 
                    ? 'High Availability aktif. Load balancer & aplikasi aktif. Database dalam mode Primary.' 
                    : 'High Availability aktif. Load balancer & aplikasi aktif. Database dalam mode Aktif-Standby.';
            } else if (cloudStatus === 'active') {
                cloudStatusDesc.textContent = databaseRole === 'cloud-primary' 
                    ? 'Aktif dan menerima 100% traffic. Database dalam mode Primary.' 
                    : 'Aktif dan menerima 100% traffic setelah failover.';
            }
            
            // Update status monitor
            if (failoverTriggered) {
                monitorStatus.textContent = 'Memantau kapan environment lokal kembali pulih untuk failback.';
            } else {
                monitorStatus.textContent = 'Aktif dan memantau kesehatan environment lokal setiap 10 detik.';
            }
            
            // Update mode operasi
            operationMode.textContent = autoMode ? 
                'Otomatis - Failover & Failback akan dijalankan otomatis setelah 5 detik.' :
                'Manual - Failover & Failback harus dijalankan secara manual.';
        }
        
        // Fungsi untuk update tombol kontrol
        function updateControls() {
            // Tombol simulasi gangguan hanya aktif saat lokal aktif
            btnSimulateFailure.disabled = localStatus !== 'active';
            
            // Tombol failover manual hanya aktif saat lokal gagal, belum failover, dan mode manual
            btnTriggerFailover.disabled = !(localStatus === 'inactive' && !failoverTriggered && !autoMode);
            
            // Tombol perbaikan lokal hanya aktif saat failover terjadi dan lokal belum diperbaiki
            btnRecoverLocal.disabled = !(failoverTriggered && !localRecovered);
            
            // Tombol failback manual hanya aktif saat lokal sudah diperbaiki, failover sudah terjadi, dan mode manual
            btnTriggerFailback.disabled = !(failoverTriggered && localRecovered && !failbackTriggered && !autoMode);
            
            // Update style tombol yang disabled
            [btnSimulateFailure, btnTriggerFailover, btnRecoverLocal, btnTriggerFailback].forEach(btn => {
                if (btn.disabled) {
                    btn.style.opacity = '0.6';
                    btn.style.cursor = 'not-allowed';
                } else {
                    btn.style.opacity = '1';
                    btn.style.cursor = 'pointer';
                }
            });
            
            // Update tombol mode
            btnToggleAutoMode.innerHTML = autoMode ? 
                '<i class="fas fa-robot"></i> Mode Otomatis: ON' : 
                '<i class="fas fa-hand-paper"></i> Mode Otomatis: OFF';
            btnToggleAutoMode.style.backgroundColor = autoMode ? '#607d8b' : '#795548';
        }
        
        // Fungsi untuk memulai countdown failover
        function startFailoverCountdown() {
            // Clear timer jika sudah ada
            if (failoverTimer) {
                clearInterval(failoverTimer);
            }
            
            // Reset countdown
            failoverCountdown = 5;
            failoverTimerEl.textContent = `${failoverCountdown}s`;
            failoverTimerEl.className = 'timer-value countdown';
            
            // Tampilkan panel timer
            timerPanel.classList.add('active');
            failoverTimerContainer.style.display = 'flex';
            failbackTimerContainer.style.display = 'none';
            
            // Mulai countdown
            failoverTimer = setInterval(() => {
                failoverCountdown--;
                failoverTimerEl.textContent = `${failoverCountdown}s`;
                
                if (failoverCountdown <= 0) {
                    clearInterval(failoverTimer);
                    failoverTimerEl.textContent = 'Menjalankan...';
                    failoverTimerEl.className = 'timer-value executing';
                    
                    // Jalankan failover setelah delay kecil
                    setTimeout(() => {
                        executeFailover();
                        failoverTimerEl.textContent = 'Selesai';
                        failoverTimerEl.className = 'timer-value completed';
                        
                        // Sembunyikan timer setelah 2 detik
                        setTimeout(() => {
                            timerPanel.classList.remove('active');
                        }, 2000);
                    }, 1000);
                }
            }, 1000);
        }
        
        // Fungsi untuk memulai countdown failback
        function startFailbackCountdown() {
            // Clear timer jika sudah ada
            if (failbackTimer) {
                clearInterval(failbackTimer);
            }
            
            // Reset countdown
            failbackCountdown = 5;
            failbackTimerEl.textContent = `${failbackCountdown}s`;
            failbackTimerEl.className = 'timer-value countdown';
            
            // Tampilkan panel timer
            timerPanel.classList.add('active');
            failoverTimerContainer.style.display = 'none';
            failbackTimerContainer.style.display = 'flex';
            
            // Mulai countdown
            failbackTimer = setInterval(() => {
                failbackCountdown--;
                failbackTimerEl.textContent = `${failbackCountdown}s`;
                
                if (failbackCountdown <= 0) {
                    clearInterval(failbackTimer);
                    failbackTimerEl.textContent = 'Menjalankan...';
                    failbackTimerEl.className = 'timer-value executing';
                    
                    // Jalankan failback setelah delay kecil
                    setTimeout(() => {
                        executeFailback();
                        failbackTimerEl.textContent = 'Selesai';
                        failbackTimerEl.className = 'timer-value completed';
                        
                        // Sembunyikan timer setelah 2 detik
                        setTimeout(() => {
                            timerPanel.classList.remove('active');
                        }, 2000);
                    }, 1000);
                }
            }, 1000);
        }
        
        // Fungsi untuk simulasi gangguan lokal
        function simulateFailure() {
            if (localStatus !== 'active') return;
            
            // Tandai semua komponen lokal (kecuali database) sebagai gagal
            localComponents.forEach(component => {
                if (component.id === 'local-db') return; // Skip database
                
                component.classList.remove('active');
                component.classList.add('failed');
                const statusText = component.querySelector('.status-text');
                statusText.textContent = 'Gagal';
                statusText.style.color = '#f44336';
            });
            
            // Update database lokal menjadi Aktif-Standby
            localDB.classList.remove('active-standby');
            localDB.classList.add('standby');
            localDB.querySelector('.status-text').textContent = 'Aktif-Standby';
            localDBBadge.textContent = 'Standby';
            localDBBadge.className = 'db-badge standby';
            
            // Update database cloud menjadi Primary
            cloudDB.classList.remove('active-standby');
            cloudDB.classList.add('active');
            cloudDB.querySelector('.status-text').textContent = 'Aktif-Primary';
            cloudDBBadge.textContent = 'Primary';
            cloudDBBadge.className = 'db-badge primary';
            
            // Update role database
            databaseRole = 'cloud-primary';
            
            // Update flow lokal
            localFlowText.textContent = '0% Traffic';
            localFlowText.style.backgroundColor = '#bdbdbd';
            localFlowArrow.style.opacity = '0.3';
            localFlowArrow.style.animation = 'none';
            
            // Update badge lokal
            localBadge.textContent = 'Failed';
            localBadge.className = 'environment-badge badge-failed';
            
            // Update status cloud (tetap High Availability)
            cloudStatus = 'high-availability';
            
            // Update status lokal
            localStatus = 'inactive';
            
            // Tambah log
            addLog('Peringatan: Environment lokal mengalami gangguan!', 'error');
            addLog('Load balancer lokal tidak merespons.', 'error');
            addLog('Aplikasi lokal mengalami downtime.', 'error');
            addLog('Database lokal diubah ke mode Aktif-Standby.', 'database');
            addLog('Database cloud diubah ke mode Aktif-Primary.', 'database');
            addLog('Environment cloud tetap dalam mode High Availability aktif.', 'ha');
            addLog('Monitor failover mendeteksi kegagalan sistem.', 'warning');
            
            if (autoMode) {
                addLog('Memulai countdown failover otomatis (5 detik)...', 'automatic');
                startFailoverCountdown();
            } else {
                addLog('Mode manual aktif. Silakan trigger failover secara manual.', 'warning');
                // Highlight tombol failover manual
                btnTriggerFailover.classList.add('highlight');
                setTimeout(() => btnTriggerFailover.classList.remove('highlight'), 1500);
            }
            
            updateStatus();
            updateControls();
        }
        
        // Fungsi untuk menjalankan failover (dipanggil oleh countdown atau manual)
        function executeFailover() {
            if (failoverTriggered || localStatus !== 'inactive') return;
            
            failoverTriggered = true;
            
            // Cloud sudah aktif (High Availability), cukup update traffic
            // Tidak perlu mengaktifkan komponen cloud karena sudah aktif
            
            // Update flow cloud untuk menerima 100% traffic
            cloudFlowText.textContent = '100% Traffic';
            cloudFlowText.style.backgroundColor = '#ff9800';
            cloudFlowText.style.opacity = '1';
            cloudFlowArrow.style.opacity = '1';
            cloudFlowArrow.style.animation = 'pulse 1s infinite';
            
            // Update badge cloud
            cloudBadge.textContent = 'Primary (HA)';
            cloudBadge.className = 'environment-badge badge-primary';
            
            // Update status cloud
            cloudStatus = 'active';
            
            // Tambah log
            if (autoMode) {
                addLog('Failover otomatis dijalankan...', 'automatic');
            } else {
                addLog('Failover manual dijalankan...', 'failover');
            }
            addLog('Mengalihkan 100% traffic ke environment cloud.', 'failover');
            addLog('Environment cloud sudah dalam mode High Availability aktif.', 'ha');
            addLog('Database cloud tetap dalam mode Primary.', 'database');
            addLog('Failover berhasil! Semua traffic sekarang diarahkan ke cloud.', 'recovery');
            
            updateStatus();
            updateControls();
        }
        
        // Fungsi untuk trigger failover (manual)
        function triggerFailover() {
            if (!autoMode && localStatus === 'inactive' && !failoverTriggered) {
                executeFailover();
            }
        }
        
        // Fungsi untuk perbaikan lokal
        function recoverLocal() {
            if (!failoverTriggered || localRecovered) return;
            
            // Tandai komponen lokal (kecuali database) sedang diperbaiki
            localComponents.forEach(component => {
                if (component.id === 'local-db') return; // Skip database
                
                component.classList.remove('failed');
                component.classList.add('recovering');
                const statusText = component.querySelector('.status-text');
                statusText.textContent = 'Memulihkan';
                statusText.style.color = '#9c27b0';
            });
            
            // Database lokal tetap dalam mode standby
            localDB.classList.remove('standby');
            localDB.classList.add('active-standby');
            localDB.querySelector('.status-text').textContent = 'Aktif-Standby';
            
            // Update badge lokal
            localBadge.textContent = 'Recovering';
            localBadge.className = 'environment-badge badge-recovering';
            
            // Update status
            localStatus = 'recovering';
            localRecovered = true;
            
            // Tambah log
            addLog('Memulai proses perbaikan environment lokal...', 'warning');
            addLog('Menginisialisasi ulang komponen lokal.', 'warning');
            addLog('Melakukan sinkronisasi data dari cloud database.', 'database');
            addLog('Environment lokal berhasil dipulihkan dan siap untuk failback.', 'recovery');
            
            if (autoMode) {
                addLog('Memulai countdown failback otomatis (5 detik)...', 'automatic');
                startFailbackCountdown();
            } else {
                addLog('Mode manual aktif. Silakan trigger failback secara manual.', 'warning');
                // Highlight tombol failback manual
                btnTriggerFailback.classList.add('highlight');
                setTimeout(() => btnTriggerFailback.classList.remove('highlight'), 1500);
            }
            
            updateStatus();
            updateControls();
        }
        
        // Fungsi untuk menjalankan failback (dipanggil oleh countdown atau manual)
        function executeFailback() {
            if (!failoverTriggered || !localRecovered || failbackTriggered) return;
            
            failbackTriggered = true;
            
            // Aktifkan kembali komponen lokal (kecuali database)
            localComponents.forEach(component => {
                if (component.id === 'local-db') return; // Database akan diupdate terpisah
                
                component.classList.remove('recovering');
                component.classList.add('active');
                const statusText = component.querySelector('.status-text');
                statusText.textContent = 'Aktif';
                statusText.style.color = '#1976d2';
                
                // Tambah efek highlight
                component.classList.add('highlight');
                setTimeout(() => component.classList.remove('highlight'), 1500);
            });
            
            // Update database lokal menjadi Primary
            localDB.classList.remove('active-standby');
            localDB.classList.add('active');
            localDB.querySelector('.status-text').textContent = 'Aktif-Primary';
            localDBBadge.textContent = 'Primary';
            localDBBadge.className = 'db-badge primary';
            
            // Update database cloud menjadi Aktif-Standby
            cloudDB.classList.remove('active');
            cloudDB.classList.add('active-standby');
            cloudDB.querySelector('.status-text').textContent = 'Aktif-Standby';
            cloudDBBadge.textContent = 'Standby';
            cloudDBBadge.className = 'db-badge standby';
            
            // Update role database
            databaseRole = 'local-primary';
            
            // Kembalikan traffic ke lokal
            localFlowText.textContent = '100% Traffic';
            localFlowText.style.backgroundColor = '#ff9800';
            localFlowArrow.style.opacity = '1';
            localFlowArrow.style.animation = 'pulse 1s infinite';
            
            // Update badge lokal
            localBadge.textContent = 'Primary';
            localBadge.className = 'environment-badge badge-primary';
            
            // Kembalikan cloud ke mode High Availability (bukan primary)
            // Komponen cloud tetap aktif (High Availability)
            
            // Update flow cloud kembali ke 0%
            cloudFlowText.textContent = '0% Traffic';
            cloudFlowText.style.backgroundColor = '#bdbdbd';
            cloudFlowText.style.opacity = '0.5';
            cloudFlowArrow.style.opacity = '0.3';
            cloudFlowArrow.style.animation = 'none';
            
            // Update badge cloud kembali ke High Availability
            cloudBadge.textContent = 'High Availability';
            cloudBadge.className = 'environment-badge badge-high-availability';
            
            // Update status
            localStatus = 'active';
            cloudStatus = 'high-availability';
            
            // Tambah log
            if (autoMode) {
                addLog('Failback otomatis dijalankan...', 'automatic');
            } else {
                addLog('Failback manual dijalankan...', 'failback');
            }
            addLog('Mengalihkan traffic kembali ke environment lokal.', 'failback');
            addLog('Load balancer lokal kembali aktif sebagai primary.', 'failback');
            addLog('Database lokal kembali ke mode Primary.', 'database');
            addLog('Database cloud kembali ke mode Aktif-Standby.', 'database');
            addLog('Environment cloud kembali ke mode High Availability aktif.', 'ha');
            addLog('Failback berhasil! Sistem kembali ke kondisi normal.', 'recovery');
            
            // Reset flags untuk siklus berikutnya
            failoverTriggered = false;
            failbackTriggered = false;
            localRecovered = false;
            
            updateStatus();
            updateControls();
        }
        
        // Fungsi untuk trigger failback (manual)
        function triggerFailback() {
            if (!autoMode && failoverTriggered && localRecovered && !failbackTriggered) {
                executeFailback();
            }
        }
        
        // Fungsi untuk toggle mode otomatis/manual
        function toggleAutoMode() {
            autoMode = !autoMode;
            
            if (autoMode) {
                addLog('Mode otomatis diaktifkan. Failover & failback akan dijalankan otomatis setelah 5 detik.', 'automatic');
            } else {
                addLog('Mode manual diaktifkan. Failover & failback harus dijalankan secara manual.', 'warning');
                
                // Hentikan semua timer jika ada
                if (failoverTimer) {
                    clearInterval(failoverTimer);
                    timerPanel.classList.remove('active');
                }
                if (failbackTimer) {
                    clearInterval(failbackTimer);
                    timerPanel.classList.remove('active');
                }
            }
            
            updateStatus();
            updateControls();
        }
        
        // Fungsi untuk reset skenario
        function resetScenario() {
            // Hentikan semua timer
            if (failoverTimer) {
                clearInterval(failoverTimer);
            }
            if (failbackTimer) {
                clearInterval(failbackTimer);
            }
            
            // Sembunyikan panel timer
            timerPanel.classList.remove('active');
            
            // Reset komponen lokal (kecuali database)
            localComponents.forEach(component => {
                if (component.id === 'local-db') {
                    // Reset database lokal ke Primary
                    component.classList.remove('standby', 'active-standby');
                    component.classList.add('active');
                    component.querySelector('.status-text').textContent = 'Aktif-Primary';
                    localDBBadge.textContent = 'Primary';
                    localDBBadge.className = 'db-badge primary';
                } else {
                    component.classList.remove('failed', 'recovering');
                    component.classList.add('active');
                    const statusText = component.querySelector('.status-text');
                    statusText.textContent = 'Aktif';
                    statusText.style.color = '';
                }
            });
            
            // Reset database cloud ke Aktif-Standby
            cloudDB.classList.remove('active', 'active-standby');
            cloudDB.classList.add('active-standby');
            cloudDB.querySelector('.status-text').textContent = 'Aktif-Standby';
            cloudDBBadge.textContent = 'Standby';
            cloudDBBadge.className = 'db-badge standby';
            
            // Update role database
            databaseRole = 'local-primary';
            
            // Reset flow lokal
            localFlowText.textContent = '100% Traffic';
            localFlowText.style.backgroundColor = '#ff9800';
            localFlowArrow.style.opacity = '1';
            localFlowArrow.style.animation = 'pulse 2s infinite';
            
            // Reset badge lokal
            localBadge.textContent = 'Primary';
            localBadge.className = 'environment-badge badge-primary';
            
            // Reset flow cloud
            cloudFlowText.textContent = '0% Traffic';
            cloudFlowText.style.backgroundColor = '#bdbdbd';
            cloudFlowText.style.opacity = '0.5';
            cloudFlowArrow.style.opacity = '0.3';
            cloudFlowArrow.style.animation = '';
            
            // Reset badge cloud
            cloudBadge.textContent = 'High Availability';
            cloudBadge.className = 'environment-badge badge-high-availability';
            
            // Reset status
            localStatus = 'active';
            cloudStatus = 'high-availability';
            failoverTriggered = false;
            failbackTriggered = false;
            localRecovered = false;
            
            // Kosongkan log dan tambah log reset
            logEntries.innerHTML = '';
            addLog('Sistem direset ke kondisi awal.');
            addLog('Environment lokal aktif kembali sebagai primary.');
            addLog('Environment cloud kembali ke mode High Availability aktif.', 'ha');
            addLog('Database lokal dalam mode Primary.', 'database');
            addLog('Database cloud dalam mode Aktif-Standby.', 'database');
            addLog('Mode otomatis aktif. Failover & failback akan dijalankan otomatis setelah 5 detik.', 'automatic');
            
            updateStatus();
            updateControls();
        }
        
        // Event listeners
        btnSimulateFailure.addEventListener('click', simulateFailure);
        btnTriggerFailover.addEventListener('click', triggerFailover);
        btnRecoverLocal.addEventListener('click', recoverLocal);
        btnTriggerFailback.addEventListener('click', triggerFailback);
        btnToggleAutoMode.addEventListener('click', toggleAutoMode);
        btnReset.addEventListener('click', resetScenario);
        
        // Inisialisasi
        updateStatus();
        updateControls();
        
        // Tambah log awal
        setTimeout(() => {
            addLog('Monitor failover aktif dan memantau sistem.');
        }, 1000);
    </script>
</body>
</html>